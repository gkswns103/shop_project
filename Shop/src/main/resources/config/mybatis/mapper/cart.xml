<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="c">
   <!-- 장바구니 전체 조회 -->
   <select id="select_list" resultType="cart" parameterType="int">
      select * from cart where user_idx=#{user_idx}
   </select>
   
   <insert id="insert_cart" parameterType="cart">
      insert into cart(user_idx,product_idx,quantity,status,name,price,discount,filepath,inventory,CHECKED,ORDERNUMBER,ORDERTIME) values
      (#{user_idx},#{product_idx},#{quantity}, 'active',#{name},#{price},#{discount},#{filepath},#{inventory},1,0,0)
   </insert>
   
   <select id="select_idx" parameterType="cart" resultType="int">
      select product_idx from cart where user_idx=#{user_idx} and product_idx=#{product_idx}
   </select>
   
   <select id="check_duplicate" resultType="int" parameterType="cart">
      select count(*)
      from cart
      where user_idx=#{user_idx} and product_idx=${product_idx}
      
   </select>
   
   <select id="check_Active" resultType="int" parameterType="cart">
      select count(*)
      from cart
      where user_idx=#{user_idx} and product_idx=${product_idx} and status='active'
      
   </select>
   
   <select id="cart_count" parameterType="int" resultType="int">
      select count(*) from cart where user_idx=#{user_idx} and status='active'
   </select>
   
   <delete id="cart_delete" parameterType="cart">
      delete from cart where user_idx=#{user_idx} and product_idx=#{product_idx}
   </delete>
   
   <update id="cart_update" parameterType="cart">
      update cart SET quantity = #{quantity} WHERE user_idx=#{user_idx} and product_idx=#{product_idx}
   </update>
   
   <update id="updateCheck" parameterType="cart" >
      update cart set checked=#{checked} where user_idx=#{user_idx} and product_idx=#{product_idx}
   </update>
   
   <select id="cart_list" resultType="cart" parameterType="int">
      select * from cart where user_idx=#{user_idx} and checked='1' and status='active'
   </select>
      
   <update id="updateState" parameterType="cart">
      update cart 
      set status='saled',ordernumber = #{ordernumber} ,ordertime = sysdate 
      where user_idx=#{user_idx} and checked='1' and status='active'
   </update>
    
    <update id="updateInventory" parameterType="int">
      UPDATE cart SET inventory = inventory - quantity 
      WHERE cart_idx IN (
        SELECT cart_idx
       FROM cart
       WHERE user_idx = #{user_idx}
       AND status = 'active'
       and checked='1' )
   </update>
   
   <delete id="delete_user" parameterType="int">
      delete from cart where user_idx = #{user_idx}
   </delete>
   
   <select id="purchaseList" parameterType="int" resultType="cart">
      select * from cart where user_idx=#{user_idx} and status='saled' order by ordernumber desc
   </select>
   
   
   
</mapper>
